# filename: main.py
# This is the BACK END (Server)
from fastapi import FastAPI, File, UploadFile
from fastapi.responses import JSONResponse
import random

app = FastAPI()

# --- MOCK AI MODEL FUNCTION ---
def analyze_image(image_filename):
    # Mock logic: Randomly determine if detection is positive or negative
    confidence = round(random.uniform(70.0, 99.9), 2)
    severity = random.choice(["Low", "Medium", "High"])
    has_anomaly = random.choice([True, False])

    if has_anomaly:
        return {
            "status": "detected",
            "label": "Anomaly Detected",
            "confidence": f"{confidence}%",
            "severity": severity,
            "advice": "Please consult a specialist immediately."
        }
    else:
        return {
            "status": "healthy",
            "label": "No Anomalies Found",
            "confidence": f"{confidence}%",
            "severity": "None",
            "advice": "Routine checkup recommended in 6 months."
        }

@app.post("/predict")
async def predict(file: UploadFile = File(...)):
    try:
        contents = await file.read()
        result = analyze_image(file.filename)
        return JSONResponse(content=result)
    except Exception as e:
        return JSONResponse(content={"error": str(e)}, status_code=500)
